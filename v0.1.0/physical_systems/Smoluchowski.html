<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Smoluchowski · WavKinS.jl</title><meta name="title" content="Smoluchowski · WavKinS.jl"/><meta property="og:title" content="Smoluchowski · WavKinS.jl"/><meta property="twitter:title" content="Smoluchowski · WavKinS.jl"/><meta name="description" content="Documentation for WavKinS.jl."/><meta property="og:description" content="Documentation for WavKinS.jl."/><meta property="twitter:description" content="Documentation for WavKinS.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../index.html"><img src="../assets/logo.png" alt="WavKinS.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">WavKinS.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><span class="tocitem">Quick start</span><ul><li><a class="tocitem" href="../quick_start/installation.html">Installing WavKinS</a></li><li><a class="tocitem" href="../quick_start/collisional_integral_tutorial.html">Computing a collisional integral</a></li><li><a class="tocitem" href="../quick_start/running_tutorial.html">Running an example</a></li><li><a class="tocitem" href="../quick_start/diagnostics_tutorial.html">Adding a diagnostic</a></li></ul></li><li><a class="tocitem" href="../basics.html">Basics</a></li><li><span class="tocitem">Physical systems</span><ul><li><a class="tocitem" href="Acoustic.html">Acoustic</a></li><li><a class="tocitem" href="Bogoliubov.html">Bogoliubov</a></li><li><a class="tocitem" href="NLS.html">NLS</a></li><li><a class="tocitem" href="MMT.html">MMT</a></li><li><a class="tocitem" href="Petviashvilli.html">Petviashvilli</a></li><li class="is-active"><a class="tocitem" href="Smoluchowski.html">Smoluchowski</a><ul class="internal"><li><a class="tocitem" href="#Smoluchowskisolver"><span>Smoluchowskisolver</span></a></li></ul></li><li><a class="tocitem" href="Stratified.html">Stratified</a></li><li><a class="tocitem" href="generalities.html">Generalities</a></li><li><a class="tocitem" href="TestTimeStepping.html">TestTimeStepping</a></li></ul></li><li><a class="tocitem" href="../numerical-methods.html">Numerical methods</a></li><li><a class="tocitem" href="../multithreading.html">Multithreading</a></li><li><a class="tocitem" href="../plots.html">Plots</a></li><li><a class="tocitem" href="../creating-new-solvers.html">Creating new solvers</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Physical systems</a></li><li class="is-active"><a href="Smoluchowski.html">Smoluchowski</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="Smoluchowski.html">Smoluchowski</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="Smoluchowskisolver"><a class="docs-heading-anchor" href="#Smoluchowskisolver">Smoluchowskisolver</a><a id="Smoluchowskisolver-1"></a><a class="docs-heading-anchor-permalink" href="#Smoluchowskisolver" title="Permalink"></a></h2><p>The Smoluchowski equation is a standard model of statistical physics. It describes coagulation processes such as droplets in clouds, blood clots, meteorite formation from stellar dust, and so on.</p><h3 id="Description"><a class="docs-heading-anchor" href="#Description">Description</a><a id="Description-1"></a><a class="docs-heading-anchor-permalink" href="#Description" title="Permalink"></a></h3><p>In this case we use <span>$k$</span> for the particle mass and <span>$n_{k}$</span> is the particle density. The collision integral is </p><p class="math-container">\[St_{k} = \frac{1}{2} \int\limits_0^k ~ K(k-p,p) ~ n(k-p,t) ~ n(p,t) ~ \mathrm{d}p -\int\limits_0^\infty ~ K(k,p) ~ n(k,t) ~ n(p,t) ~ \mathrm{d}p.\]</p><p>The coagulation kernel <span>$K(k,p)$</span> describes the rate at which particles of mass <span>$k$</span> coagulate with particles of mass <span>$p$</span>. The constant, additive, and multiplicative kernels are defined as</p><p class="math-container">\[K(k,p) = 1, ~~~~ K(k,p) = k + p, ~~~~ K(k,p) = k p\]</p><p>respectively. These kernels are defined in <code>src/physical_systems/Smoluchowski/basics.jl</code>. Using other kernels is easy since <span>$K$</span> is passed as an element of the <a href="Smoluchowski.html#WavKinS.Smoluchowski"><code>Smoluchowski</code></a> structure. For more information about the Smoluchowski equation, you can refer to <a href="https://en.wikipedia.org/wiki/Smoluchowski_coagulation_equation">wikipedia</a>.</p><p>Note that in the general case, there is only <span>$1$</span> integral to perform for each element of in mass space. Solving this equation will then require <span>$M^2$</span> operation per time-step, where <span>$M$</span> is the number of discretization points of the mass space. It makes the simulation relatively cheap.</p><p>This wave kinetic equation conserves the total mass <span>$H$</span></p><p class="math-container">\[H = \int k n_{\bf k} d{\bf k}.\]</p><h3 id="Solver"><a class="docs-heading-anchor" href="#Solver">Solver</a><a id="Solver-1"></a><a class="docs-heading-anchor-permalink" href="#Solver" title="Permalink"></a></h3><h4 id="Numerical-method"><a class="docs-heading-anchor" href="#Numerical-method">Numerical method</a><a id="Numerical-method-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-method" title="Permalink"></a></h4><p>The computation of the collision integral <span>$St_{k}$</span> is straightforward. We use logarithmic grid <a href="../basics.html#WavKinS.wave_spectrum"><code>wave_spectrum</code></a>. </p><p>The different options are described in the <a href="Smoluchowski.html#WavKinS.Smoluchowski"><code>Smoluchowski</code></a> documentation.</p><h4 id="Using-the-Smoluchowski-solver"><a class="docs-heading-anchor" href="#Using-the-Smoluchowski-solver">Using the Smoluchowski solver</a><a id="Using-the-Smoluchowski-solver-1"></a><a class="docs-heading-anchor-permalink" href="#Using-the-Smoluchowski-solver" title="Permalink"></a></h4><p>As all the other WavKinS solvers, for Smoluchowski we need to create a <a href="Smoluchowski.html#WavKinS.Smoluchowski"><code>Smoluchowski</code></a> structure containing all the fields, working space, diagnostics, etc.  </p><pre><code class="language-julia hljs">using WavKinS

# Create a waveaction structure containing the basic grid
M = 1024 # set the number of nodes
kmin = 5e-3 # minimal wave number
kmax = 1e0 # maximal wave number
Nk = wave_spectrum(kmin, kmax, M)

# Creating a NLS3D run structure with default parameters and multiplicative kernel.
Run = Smoluchowski(Nk; K=WavKinS.K_Smoluchowski_multiplicative)</code></pre><p>Note that the constructor allows to define the coagulation kernel in the structure so it is easy to use this solver to study many different physical systems. For example, you can investigate systems with kernels of the form <span>$K(k,p) = (k p)^{1/3}$</span> by using</p><pre><code class="language-julia hljs">function K_spec(k,p)
    return (k*p)^(1/3)
end

Run = Smoluchowski(Nk; K=K_spec)</code></pre><h4 id="Diagnostics"><a class="docs-heading-anchor" href="#Diagnostics">Diagnostics</a><a id="Diagnostics-1"></a><a class="docs-heading-anchor-permalink" href="#Diagnostics" title="Permalink"></a></h4><p>This solver has the standard diagnostics.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>For consistency with other systems, we fix the &quot;wave frequency&quot; to the particle mass, i.e. <span>$\omega_{k} = k$</span>. In that way, you can use basic diagnostics as for other solvers, but with a different meaning. For example, the &quot;energy&quot; <a href="../basics.html#WavKinS.energy-Tuple{Any}"><code>energy</code></a> is the total mass of particles and the &quot;energy flux&quot; <a href="../basics.html#WavKinS.energy_flux!-Tuple{AbstractVector, Any}"><code>energy_flux!</code></a> is the mass flux.</p></div></div><h4 id="Testing-convergence-of-the-collisional-integral"><a class="docs-heading-anchor" href="#Testing-convergence-of-the-collisional-integral">Testing convergence of the collisional integral</a><a id="Testing-convergence-of-the-collisional-integral-1"></a><a class="docs-heading-anchor-permalink" href="#Testing-convergence-of-the-collisional-integral" title="Permalink"></a></h4><p>WavKinS provide a simple test of the numerical convergence of the computation of the collisional integral. The testing script is located in <code>/run/tests/physical_systems/tests_Smoluchowski.jl</code>. </p><p>Theoretically, the collisional integral should conserve the mass, which means that</p><p class="math-container">\[\int_0^{k_{\rm max}} St_k k dk=0.\]</p><p>The following numerical test evaluates those integrals and check the convergence to <span>$0$</span>.</p><pre><code class="language-julia hljs">using WavKinS

function nk_test(kk)
    nk = kk^2 * exp(-kk / 50.0) / 250000
    return nk
end

println(&quot;---------------------------------------------------------------------&quot;)
println(&quot;Testing collisional integral&quot;)
println(&quot;&quot;)

for M ∈ 2 .^ (4:9)
    kmin = 5e-3
    kmax = 5e+3

    Nk = wave_spectrum(kmin,kmax,M);
    Run = Smoluchowski(Nk; K=WavKinS.K_Smoluchowski_one, interp_scheeme=WavKinS.lin_interp);

    kk = Nk.kk
    λ = Nk.λ
  
    @. Nk.nk = nk_test.(kk);

    WavKinS.St_k!(Run)
    
    Flux = wave_spectrum(kmin,kmax,M)
    @. Flux.nk = Run.Sk.nk .* Run.ω.(kk);
    FluxNumH = integrate(Flux)

    Ene = energy(Run)
    
    println(&quot;M in k= &quot;, M, &quot;, Integral flux num: dH/H=&quot;, FluxNumH / Ene)
end

println(&quot;&quot;)
println(&quot;---------------------------------------------------------------------&quot;)</code></pre><p>The output of this test is </p><pre><code class="nohighlight hljs">---------------------------------------------------------------------
Testing collisional integral

M in k= 16, Integral flux num: dH/H=0.2848719543347318
M in k= 32, Integral flux num: dH/H=0.04709845613146857
M in k= 64, Integral flux num: dH/H=0.015286090880996035
M in k= 128, Integral flux num: dH/H=0.003651780879324013
M in k= 256, Integral flux num: dH/H=0.0009964865076014901
M in k= 512, Integral flux num: dH/H=0.0002502083115315172

---------------------------------------------------------------------</code></pre><p>The solver conserves well the waveaction and errors on energy conservation roughly decreases as <span>$M^{-2}$</span>.</p><h3 id="Theoretical-predictions"><a class="docs-heading-anchor" href="#Theoretical-predictions">Theoretical predictions</a><a id="Theoretical-predictions-1"></a><a class="docs-heading-anchor-permalink" href="#Theoretical-predictions" title="Permalink"></a></h3><p>For kernel of the form <span>$K(k,p) = a (kp)^{\xi/2}$</span>, the wave turbulence theory provides analytical prediction for out-of-equilibrium steady states obtained with forcing and dissipation, associated to a direct cascade of mass. The corresponding theoretical prediction are (see <a href="https://journals.aps.org/pre/abstract/10.1103/PhysRevE.69.061114">Connaughton <em>et al.</em>, Phys. Rev. E 69, 061114 (2004)</a> ):  </p><p class="math-container">\[n_k=C_{KZ}^P |P_0|^{1/2}k^{-(3+\xi)/2}\]</p><p>where <span>$P_0$</span> is mass flux, and the superscript <span>$P$</span> denotes the direct mass cascade. The theory also predicts the values of the dimensionless constant</p><p class="math-container">\[C_{KZ}^P=\frac{1}{\sqrt{2 \pi a}}.\]</p><h4 id="Running-the-Smoluchowski-solver"><a class="docs-heading-anchor" href="#Running-the-Smoluchowski-solver">Running the Smoluchowski solver</a><a id="Running-the-Smoluchowski-solver-1"></a><a class="docs-heading-anchor-permalink" href="#Running-the-Smoluchowski-solver" title="Permalink"></a></h4><p>WavKinS provides a ready to use script to obtain out-of-equilibrium steady states of the WKE. The script is similar to the one presented in the tutorial and can be found in <code>/run/simple/RunSimpleEvolution_Smoluchowski.jl</code>. Running the script will generate the following plot exhibiting the steady state direct mass cascade. </p><p><img src="../assets/Smoluchowski_spectrum.png" alt/> The dashed line is the theoretical prediction, with no adjustable parameters. The gelation process (see <a href="https://journals.aps.org/pre/abstract/10.1103/PhysRevE.84.011111">Ball <em>et al.</em>, Phys. Rev. E 84, 011111 (2011)</a> ), corresponding to a non-local transfer of small mass to large mass, explains the spectral bump at large mass.</p><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>The simulation took 39.1 seconds on a 2.30 GHz 8-Core 11th Gen Intel(R) Core(TM) i7-11800H, using 8 cores. </p></div></div><h3 id="List-of-structures-and-methods-for-Smoluchowski-solver"><a class="docs-heading-anchor" href="#List-of-structures-and-methods-for-Smoluchowski-solver">List of structures and methods for Smoluchowski solver</a><a id="List-of-structures-and-methods-for-Smoluchowski-solver-1"></a><a class="docs-heading-anchor-permalink" href="#List-of-structures-and-methods-for-Smoluchowski-solver" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="WavKinS.Smoluchowski" href="#WavKinS.Smoluchowski"><code>WavKinS.Smoluchowski</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Smoluchowski</code></pre><p>Simulation structure for Smoluchowski. It contains</p><pre><code class="nohighlight hljs">name::String #name of the simulation type
Nk_arguments::Int # Number of arguments of ``n_k``. 1: (fully symetric) , 2: (cylindrical average in 3D or mirror symmetric in 2D), 3: Only mirror symmetric in 3D
ω # Particle size
K # Kernel

Nk::wave_spectrum #wave action
Sk::wave_spectrum #collisional integral
F1::wave_spectrum #working field
FSt::Vector{wave_spectrum} #Array of working fields for multithreading
partition::Vector{UnitRange{Int64}} #partition for multithreading

# Type of interpolation and time stepping scheemes
interp_scheeme::Interp_Scheeme
time_stepping::Time_Stepping

# Outputs and diagnostics
diags::diagnostic_container

t::Float64 #current time
dimension::Int # physical dimension of the system (or of the isotropic sector)
dΩ::Float64 # surface of the unit sphere (or of the isotropic sector)

FD::force_dissipation # Contains all the terms about force and dissipation.</code></pre></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="WavKinS.Smoluchowski-Tuple{wave_spectrum}" href="#WavKinS.Smoluchowski-Tuple{wave_spectrum}"><code>WavKinS.Smoluchowski</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Smoluchowski(Nk::wave_spectrum; K=K_Smoluchowski_one, interp_scheeme=lin_interp,time_stepping_scheeme=RK2_step</code></pre><p>Constructor of a <a href="Smoluchowski.html#WavKinS.Smoluchowski"><code>Smoluchowski</code></a> structure. Optionally we set interpolation and time-stepping scheemes:</p><ul><li><code>interp_scheeme</code>: <a href="../numerical-methods.html#WavKinS.lin_interp-Tuple{AbstractVector}"><code>lin_interp</code></a> (default), <a href="../numerical-methods.html#WavKinS.powexp_interp-Tuple{AbstractVector}"><code>powexp_interp</code></a>, <a href="../numerical-methods.html#WavKinS.powGauss_interp-Tuple{AbstractVector}"><code>powGauss_interp</code></a>, <a href="../numerical-methods.html#WavKinS.BS_interp-Tuple{AbstractVector}"><code>BS_interp</code></a></li><li><code>time_stepping_scheeme</code>: <a href="../numerical-methods.html#WavKinS.Euler_step"><code>Euler_step</code></a>, <a href="../numerical-methods.html#WavKinS.RK2_step"><code>RK2_step</code></a> (default), <a href="../numerical-methods.html#WavKinS.RK4_step"><code>RK4_step</code></a></li></ul><p>The optional parameter <code>K</code> is the coagulation kernel.</p></div></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="Petviashvilli.html">« Petviashvilli</a><a class="docs-footer-nextpage" href="Stratified.html">Stratified »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Monday 9 December 2024 21:53">Monday 9 December 2024</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
